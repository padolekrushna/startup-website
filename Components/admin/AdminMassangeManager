import React, { useState, useEffect } from 'react';
import { ContactMessage } from '@/entities/ContactMessage';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Accordion, AccordionContent, AccordionItem, AccordionTrigger } from "@/components/ui/accordion";
import { format } from 'date-fns';

export default function AdminMessageManager() {
    const [messages, setMessages] = useState([]);
    const [loading, setLoading] = useState(true);

    useEffect(() => {
        fetchMessages();
    }, []);

    const fetchMessages = async () => {
        setLoading(true);
        const data = await ContactMessage.list("-created_date");
        setMessages(data);
        setLoading(false);
    };

    return (
        <Card className="border-0 shadow-xl bg-white/80 backdrop-blur-sm">
            <CardHeader>
                <CardTitle>Contact Messages</CardTitle>
            </CardHeader>
            <CardContent>
                {loading ? <p>Loading messages...</p> : (
                    <Accordion type="single" collapsible className="w-full">
                        {messages.map(msg => (
                            <AccordionItem value={msg.id} key={msg.id}>
                                <AccordionTrigger>
                                    <div className="flex justify-between w-full pr-4">
                                        <div className="flex-1 text-left">
                                            <p className="font-semibold">{msg.subject}</p>
                                            <p className="text-sm text-slate-500">{msg.name} ({msg.email})</p>
                                        </div>
                                        <p className="text-sm text-slate-500">{format(new Date(msg.created_date), 'PPP')}</p>
                                    </div>
                                </AccordionTrigger>
                                <AccordionContent className="p-4 bg-slate-50 rounded-md">
                                    {msg.message}
                                </AccordionContent>
                            </AccordionItem>
                        ))}
                    </Accordion>
                )}
            </CardContent>
        </Card>
    );
}
